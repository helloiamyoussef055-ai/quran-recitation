<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recitation of Allah Subhanahu wa Ta'ala</title>
  <style>
    body {
      font-family: 'Amiri', serif;
      background: linear-gradient(to bottom, #0a3d62, #3c6382);
      color: white;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    header {
      background: #1e3799;
      padding: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
    }
    #quran-text {
      margin: 20px auto;
      max-width: 800px;
      line-height: 2.2;
      font-size: 1.4rem;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
    }
    .ayah {
      display: inline-block;
      margin: 0 6px;
      padding: 3px 6px;
      border-radius: 6px;
    }
    .highlight {
      background: cyan;
      color: black;
    }
    .controls {
      margin: 20px;
    }
    button {
      background: #38ada9;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      color: white;
      transition: background 0.3s;
    }
    button:hover {
      background: #079992;
    }
    select {
      padding: 8px;
      border-radius: 6px;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <header>üìñ Recitation of Allah Subhanahu wa Ta'ala</header>

  <div class="controls">
    <label for="surah">Choose Surah: </label>
    <select id="surah"></select>
    <button id="play">‚ñ∂ Play</button>
    <button id="pause">‚è∏ Pause</button>
    <button id="next">‚è≠ Next Surah</button>
  </div>

  <div id="quran-text">Loading surah...</div>

  <audio id="player"></audio>

  <script>
    const surahSelect = document.getElementById('surah');
    const quranText = document.getElementById('quran-text');
    const player = document.getElementById('player');
    let currentSurah = 1;
    let timings = [];

    // Load Surah list
    async function loadSurahList() {
      const res = await fetch('https://api.quran.com/v4/chapters');
      const data = await res.json();
      data.chapters.forEach(chap => {
        let option = document.createElement('option');
        option.value = chap.id;
        option.textContent = chap.name_arabic + " (" + chap.name_simple + ")";
        surahSelect.appendChild(option);
      });
    }

    // Load Surah text + audio
    async function loadSurah(id) {
      currentSurah = id;
      quranText.innerHTML = "Loading surah...";
      const res = await fetch(`https://api.quran.com/v4/quran/verses/uthmani?chapter_number=${id}`);
      const data = await res.json();

      quranText.innerHTML = "";
      data.verses.forEach((v, i) => {
        let span = document.createElement('span');
        span.classList.add('ayah');
        span.id = "ayah-" + v.id;
        span.textContent = v.text_uthmani + " Ô¥ø" + (i+1) + "Ô¥æ ";
        quranText.appendChild(span);
      });

      // load timings for highlighting
      const tRes = await fetch(`https://api.quran.com/v4/recitations/7/by_chapter/${id}`); 
      const tData = await tRes.json();
      timings = tData.audio_files[0].verse_timings;

      // load surah audio
      player.src = tData.audio_files[0].audio_url;
    }

    // Highlight ayah while playing
    player.ontimeupdate = () => {
      if (!timings) return;
      const currentTime = player.currentTime;
      timings.forEach(t => {
        const ayahEl = document.getElementById("ayah-" + t.verse_key.replace(":", ""));
        if (ayahEl) {
          if (currentTime >= t.timestamp_from && currentTime <= t.timestamp_to) {
            ayahEl.classList.add("highlight");
          } else {
            ayahEl.classList.remove("highlight");
          }
        }
      });
    };

    // Buttons
    document.getElementById('play').onclick = () => player.play();
    document.getElementById('pause').onclick = () => player.pause();
    document.getElementById('next').onclick = () => {
      loadSurah(currentSurah + 1);
      player.play();
    };
    surahSelect.onchange = e => loadSurah(e.target.value);

    // Init
    loadSurahList().then(() => loadSurah(1));
  </script>
</body>
</html>
